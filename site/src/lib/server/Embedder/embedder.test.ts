import { describe, it, expect, beforeEach } from "vitest"
import { QUERY, EMBEDDING } from "mocks"
import Embedder from "./embedder"

describe("Embedder", () => {
	let embedder: Embedder
	beforeEach(() => {
		embedder = Embedder()
	})

	it("returns embeddings", async () => {
		const result = await embedder.embed(QUERY)

		expect(result).toStrictEqual(EMBEDDING)
	})

	it("supports simultaneous queries", async () => {
		const simultaneousQuery = "Simultaenous query"

		const promise1 = embedder.embed(QUERY)
		const promise2 = embedder.embed(simultaneousQuery)
		const result2 = await promise2
		const result1 = await promise1

		expect(result1).toStrictEqual(EMBEDDING)
		expect(result2).toStrictEqual([
			0.0730318, 0.03543133, -0.04289623, 0.0402833, -0.12921077, 0.01033621,
			0.11983181, 0.03024139, 0.01676469, -0.00461638, 0.04991942, -0.07464373,
			0.06132551, -0.05389895, -0.01195214, -0.01440861, -0.0020456, 0.01400184,
			-0.04715177, -0.080796, 0.02904814, -0.01486827, -0.0532818, -0.01767935,
			0.00691825, -0.00785284, -0.01127749, -0.05285515, 0.10022455,
			-0.00276688, -0.06039913, 0.07445715, -0.03675731, 0.05015797, 0.05555734,
			-0.10392979, -0.0283223, -0.06030912, 0.05717036, 0.00564764, -0.03692346,
			-0.05751039, 0.00775366, -0.0002275, -0.0075808, 0.06658517, -0.08423009,
			0.07798453, -0.01482224, -0.00918094, -0.16703579, -0.00407253,
			-0.08783607, 0.00642183, 0.08515543, 0.00125841, -0.09849446, -0.01290562,
			-0.04710376, 0.0244401, -0.00437678, 0.00155309, -0.01634378, 0.00252417,
			0.00691385, -0.05149254, 0.00719293, 0.0298392, 0.10493971, -0.04461651,
			0.05378058, 0.01907939, -0.03922574, 0.05446732, -0.04130217, 0.10911751,
			-0.00608626, -0.0269786, 0.04057981, 0.00263731, -0.01764381, -0.03622583,
			-0.0716229, -0.00550183, 0.06152762, -0.03674274, -0.02108166,
			-0.00975983, 0.06380098, 0.00474306, 0.00862569, 0.02490953, 0.0023297,
			-0.01080853, -0.0208419, -0.00923652, 0.06406502, -0.03835198, 0.05835617,
			0.12691146, -0.00006311, 0.02953326, -0.02904977, -0.07000527,
			-0.17946418, -0.00146833, -0.01314174, -0.05280935, 0.02787214,
			-0.04586111, -0.08757877, 0.0469228, 0.06538326, -0.05257909, -0.0405883,
			-0.00626277, -0.00773721, 0.02221693, 0.09629788, -0.06563751, 0.04803704,
			0.07603319, -0.05990604, 0.0035414, 0.02838721, -0.0683005, 0.07456028, 0,
			0.00774958, -0.00455402, 0.06592291, -0.00651584, -0.02446756, 0.0452248,
			-0.00950984, 0.00599348, -0.01696302, 0.08093617, -0.02867189, 0.02088217,
			0.0260264, 0.03341753, -0.01875051, 0.00219264, 0.06756724, -0.00637359,
			-0.05523876, 0.0422121, -0.01692021, 0.01382678, -0.00228413, 0.0619357,
			0.02487386, 0.00352892, -0.04420471, -0.02683569, 0.02114172, 0.04513276,
			-0.01522627, -0.00642567, -0.14033101, -0.07321081, 0.03043525,
			0.04347915, 0.07653604, -0.03934499, -0.04177515, 0.03871639, -0.04360486,
			0.00178478, 0.06938094, 0.00897861, -0.0284565, -0.0455274, -0.04123367,
			-0.02408913, 0.07996549, 0.01261022, -0.04248013, -0.00696591, 0.0331854,
			-0.04199366, 0.09856237, -0.0044538, -0.00120766, 0.10386566, -0.01456514,
			0.10139486, -0.0371145, -0.07105529, -0.03032347, -0.04438419, 0.02391092,
			0.02931146, -0.09271947, -0.09909096, 0.08920629, 0.05293787, 0.01449924,
			0.02394196, 0.02460637, -0.03435258, 0.00356336, 0.02250427, 0.01542456,
			0.05381239, 0.04838932, -0.03531822, -0.00174803, -0.02564381,
			-0.01841516, 0.05067268, -0.01557376, 0.0425874, 0.05241254, -0.01098395,
			0.02337094, -0.00958191, -0.03338831, -0.02035501, 0.01642154,
			-0.00455073, 0.0373592, -0, -0.07197348, 0.02798569, -0.05225338,
			-0.03425082, -0.00753483, -0.04234454, 0.05291593, -0.06496766,
			-0.06843001, -0.05809867, -0.01823852, -0.05014484, 0.04740219,
			-0.04610642, 0.05499561, 0.10966572, 0.06015569, -0.07439739, -0.04501118,
			0.09730711, -0.0752709, 0.0425605, -0.07697562, -0.03650964, 0.04405421,
			-0.01525722, -0.0127194, -0.02639348, -0.05843144, -0.02188515, 0.0400214,
			-0.14231212, 0.02507152, -0.00280569, -0.04641993, -0.04500129,
			0.08673996, 0.03387812, -0.01938927, 0.01334872, 0.00813212, -0.02705206,
			0.08816019, 0.12258574, 0.0024552, 0.00072733, -0.10203875, -0.02624603,
			0.06198256, 0.01785998, 0.01073487, 0.04325521, -0.02606128, -0.0315867,
			0.08564632, -0.03637231, -0.11554186, -0.01127824, 0.00475333,
			-0.00865742, -0.00145801, 0.07061757, -0.04176587, 0.00651616, 0.07591913,
			-0.04406678, -0.08102136, -0.05413576, -0.08409208, -0.05731269,
			0.01093077, -0.03214256, -0.02885018, -0.07323103, -0.03691091,
			0.00794914, -0.05831092, 0.07717031, -0.00696706, 0.04442139, -0.02523063,
			0.02950756, 0.06391841, 0.02327974, -0.04560005, -0.00177571, 0.08223121,
			-0.02465232, 0.03902327, -0.00626625, -0.03321952, -0.01125146,
			-0.01225541, -0.04522516, 0.05380892, -2e-8, -0.06963475, 0.00153882,
			-0.03550375, 0.04312204, 0.11406973, 0.03034921, -0.00152718, 0.1330909,
			-0.05572799, -0.01735226, 0.01318563, -0.05555899, 0.0470917, -0.00030147,
			0.06612127, -0.0222177, 0.00454482, -0.02386635, -0.03623434, -0.02055035,
			-0.01161424, 0.01967964, -0.01855931, -0.0478723, -0.0239243, 0.08018348,
			0.01132959, -0.0004306, 0.05367596, 0.07483626, -0.01443794, 0.00793402,
			0.07200897, -0.01673794, -0.00190868, -0.08635516, -0.01465111,
			0.01999857, -0.02162843, -0.10198518, 0.0113621, -0.02099249, -0.00217232,
			0.10722118, 0.06382815, -0.05981935, 0.07941268, -0.05179355, 0.05260853,
			-0.02682371, -0.04711293, -0.09554998, 0.0198595, -0.02397372,
			-0.05478397, 0.00765332, 0.04902021, 0.04977147, -0.04637315, -0.00977737,
			0.01573741, 0.02057491, -0.0384694, 0.03557357,
		])
	})
})
